{
  "name": "full-app-test",
  "version": "1.0.0",
  "description": "Test: Complete application with multiple orbitals",
  "orbitals": [
    {
      "name": "TaskManager",
      "entity": {
        "name": "Task",
        "persistence": "persistent",
        "collection": "tasks",
        "fields": [
          { "name": "id", "type": "string", "required": true },
          { "name": "title", "type": "string", "required": true },
          { "name": "description", "type": "string" },
          { "name": "priority", "type": "enum", "values": ["low", "medium", "high"], "default": "medium" },
          { "name": "dueDate", "type": "date" },
          { "name": "assigneeId", "type": "string" },
          { "name": "projectId", "type": "string" }
        ]
      },
      "traits": [
        {
          "name": "TaskLifecycle",
          "linkedEntity": "Task",
          "category": "interaction",
          "emits": [
            {
              "event": "TASK_COMPLETED",
              "scope": "external",
              "description": "Emitted when a task is completed",
              "payload": [
                { "name": "taskId", "type": "string", "required": true },
                { "name": "projectId", "type": "string", "required": false }
              ]
            }
          ],
          "stateMachine": {
            "states": [
              { "name": "todo", "isInitial": true },
              { "name": "inProgress" },
              { "name": "review" },
              { "name": "done", "isTerminal": true, "description": "Task completed" }
            ],
            "events": [
              { "key": "INIT", "name": "Initialize" },
              { "key": "START", "name": "Start Task" },
              { "key": "SUBMIT_FOR_REVIEW", "name": "Submit for Review" },
              { "key": "APPROVE", "name": "Approve" },
              { "key": "REJECT", "name": "Request Changes" },
              { "key": "COMPLETE", "name": "Complete" }
            ],
            "transitions": [
              {
                "from": "todo",
                "event": "INIT",
                "to": "todo",
                "effects": [
                  ["fetch", "Task"],
                  ["render-ui", "main", {
                    "type": "stats",
                    "items": [
                      { "label": "Todo", "value": "@entity.todo" },
                      { "label": "In Progress", "value": "@entity.inProgress" },
                      { "label": "Done", "value": "@entity.done" }
                    ]
                  }]
                ]
              },
              { "from": "todo", "event": "START", "to": "inProgress" },
              { "from": "inProgress", "event": "SUBMIT_FOR_REVIEW", "to": "review" },
              { "from": "review", "event": "APPROVE", "to": "done", "effects": [
                ["emit", "TASK_COMPLETED", { "taskId": "@entity.id", "projectId": "@entity.projectId" }]
              ]},
              { "from": "review", "event": "REJECT", "to": "inProgress" },
              { "from": "inProgress", "event": "COMPLETE", "to": "done", "effects": [
                ["emit", "TASK_COMPLETED", { "taskId": "@entity.id", "projectId": "@entity.projectId" }]
              ]}
            ]
          }
        },
        {
          "name": "TaskCRUD",
          "linkedEntity": "Task",
          "category": "interaction",
          "emits": [
            {
              "event": "TASK_CREATED",
              "scope": "external",
              "description": "Emitted when a new task is created",
              "payload": [
                { "name": "taskId", "type": "string", "required": true },
                { "name": "projectId", "type": "string", "required": false }
              ]
            }
          ],
          "stateMachine": {
            "states": [
              { "name": "listing", "isInitial": true },
              { "name": "creating" },
              { "name": "editing" }
            ],
            "events": [
              { "key": "INIT", "name": "Initialize" },
              { "key": "VIEW", "name": "View Task", "payload": [
                { "name": "id", "type": "string", "required": true }
              ]},
              { "key": "CREATE", "name": "Create Task" },
              { "key": "EDIT", "name": "Edit Task" },
              { "key": "SAVE", "name": "Save" },
              { "key": "CANCEL", "name": "Cancel" },
              { "key": "DELETE", "name": "Delete Task" }
            ],
            "transitions": [
              {
                "from": "listing",
                "event": "INIT",
                "to": "listing",
                "effects": [
                  ["fetch", "Task"],
                  ["render-ui", "main", {
                    "type": "entity-table",
                    "entity": "Task",
                    "columns": ["title", "priority", "dueDate"],
                    "itemActions": [
                      { "event": "VIEW", "label": "View" },
                      { "event": "EDIT", "label": "Edit" },
                      { "event": "DELETE", "label": "Delete" }
                    ]
                  }]
                ]
              },
              {
                "from": "listing",
                "event": "CREATE",
                "to": "creating",
                "effects": [
                  ["render-ui", "main", {
                    "type": "form",
                    "entity": "Task"
                  }]
                ]
              },
              {
                "from": "creating",
                "event": "SAVE",
                "to": "listing",
                "effects": [
                  ["persist", "update", "Task", "@entity"],
                  ["emit", "TASK_CREATED", { "taskId": "@entity.id", "projectId": "@entity.projectId" }],
                  ["notify", "success", "Task created"]
                ]
              },
              { "from": "creating", "event": "CANCEL", "to": "listing" },
              {
                "from": "listing",
                "event": "EDIT",
                "to": "editing"
              },
              {
                "from": "editing",
                "event": "SAVE",
                "to": "listing",
                "effects": [
                  ["persist", "update", "Task", "@entity"]
                ]
              },
              { "from": "editing", "event": "CANCEL", "to": "listing" },
              {
                "from": "listing",
                "event": "DELETE",
                "to": "listing",
                "effects": [
                  ["persist", "delete", "Task", "@entity.id"],
                  ["notify", "info", "Task deleted"]
                ]
              },
              {
                "from": "listing",
                "event": "VIEW",
                "to": "listing",
                "effects": [
                  ["navigate", "/tasks/@payload.id"]
                ]
              }
            ]
          }
        }
      ],
      "pages": [
        {
          "name": "TaskListPage",
          "path": "/tasks",
          "traits": [
            { "ref": "TaskCRUD", "linkedEntity": "Task" }
          ]
        }
      ],
      "emits": ["TASK_COMPLETED", "TASK_CREATED"]
    },
    {
      "name": "ProjectManager",
      "entity": {
        "name": "Project",
        "persistence": "persistent",
        "collection": "projects",
        "fields": [
          { "name": "id", "type": "string", "required": true },
          { "name": "name", "type": "string", "required": true },
          { "name": "description", "type": "string" },
          { "name": "taskCount", "type": "number", "default": 0 },
          { "name": "completedCount", "type": "number", "default": 0 }
        ]
      },
      "traits": [
        {
          "name": "ProjectStats",
          "linkedEntity": "Project",
          "category": "interaction",
          "stateMachine": {
            "states": [
              { "name": "idle", "isInitial": true }
            ],
            "events": [
              { "key": "INIT", "name": "Initialize" },
              { "key": "TASK_COMPLETED", "name": "Task Completed" },
              { "key": "TASK_CREATED", "name": "Task Created" }
            ],
            "transitions": [
              {
                "from": "idle",
                "event": "INIT",
                "to": "idle",
                "effects": [
                  ["fetch", "Project"],
                  ["render-ui", "main", {
                    "type": "stats",
                    "items": [
                      { "label": "Total Tasks", "value": "@entity.taskCount" },
                      { "label": "Completed", "value": "@entity.completedCount" }
                    ]
                  }]
                ]
              },
              {
                "from": "idle",
                "event": "TASK_CREATED",
                "to": "idle",
                "effects": [
                  ["increment", "@entity.taskCount", 1]
                ]
              },
              {
                "from": "idle",
                "event": "TASK_COMPLETED",
                "to": "idle",
                "effects": [
                  ["increment", "@entity.completedCount", 1]
                ]
              }
            ]
          },
          "listens": [
            { "event": "TASK_COMPLETED", "scope": "external" },
            { "event": "TASK_CREATED", "scope": "external" }
          ]
        }
      ],
      "pages": [
        {
          "name": "ProjectListPage",
          "path": "/projects",
          "traits": [
            { "ref": "ProjectStats", "linkedEntity": "Project" }
          ]
        }
      ],
      "listens": [
        { "event": "TASK_COMPLETED", "from": "TaskManager" },
        { "event": "TASK_CREATED", "from": "TaskManager" }
      ]
    },
    {
      "name": "UserManager",
      "entity": {
        "name": "User",
        "persistence": "persistent",
        "collection": "users",
        "fields": [
          { "name": "id", "type": "string", "required": true },
          { "name": "name", "type": "string", "required": true },
          { "name": "email", "type": "string", "required": true },
          { "name": "role", "type": "enum", "values": ["admin", "member", "guest"], "default": "member" }
        ]
      },
      "traits": [
        {
          "name": "UserBrowser",
          "linkedEntity": "User",
          "category": "interaction",
          "stateMachine": {
            "states": [{ "name": "browsing", "isInitial": true }],
            "events": [
              { "key": "INIT", "name": "Initialize" },
              { "key": "VIEW", "name": "View User", "payload": [
                { "name": "id", "type": "string", "required": true }
              ]}
            ],
            "transitions": [
              {
                "from": "browsing",
                "event": "INIT",
                "to": "browsing",
                "effects": [
                  ["fetch", "User"],
                  ["render-ui", "main", {
                    "type": "entity-table",
                    "entity": "User",
                    "columns": ["name", "email", "role"],
                    "itemActions": [{ "event": "VIEW", "label": "View" }]
                  }]
                ]
              },
              {
                "from": "browsing",
                "event": "VIEW",
                "to": "browsing",
                "effects": [
                  ["navigate", "/users/@payload.id"]
                ]
              }
            ]
          }
        }
      ],
      "pages": [
        {
          "name": "UserListPage",
          "path": "/users",
          "traits": [{ "ref": "UserBrowser", "linkedEntity": "User" }]
        }
      ]
    }
  ]
}
