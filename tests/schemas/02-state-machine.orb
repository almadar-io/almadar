{
  "name": "state-machine-test",
  "version": "1.0.0",
  "description": "Test: State machine with transitions",
  "orbitals": [
    {
      "name": "OrderManager",
      "entity": {
        "name": "Order",
        "persistence": "persistent",
        "collection": "orders",
        "fields": [
          { "name": "id", "type": "string", "required": true },
          { "name": "customerName", "type": "string", "required": true },
          { "name": "total", "type": "number", "default": 0 }
        ]
      },
      "traits": [
        {
          "name": "OrderLifecycle",
          "linkedEntity": "Order",
          "category": "interaction",
          "stateMachine": {
            "states": [
              { "name": "pending", "isInitial": true },
              { "name": "confirmed" },
              { "name": "shipped" },
              { "name": "delivered", "isTerminal": true, "description": "Terminal state - order complete" },
              { "name": "cancelled", "isTerminal": true, "description": "Terminal state - order cancelled" }
            ],
            "events": [
              { "key": "INIT", "name": "Initialize" },
              { "key": "VIEW", "name": "View Order", "payload": [
                { "name": "id", "type": "string", "required": true }
              ]},
              { "key": "CONFIRM", "name": "Confirm Order" },
              { "key": "SHIP", "name": "Ship Order" },
              { "key": "DELIVER", "name": "Mark Delivered" },
              { "key": "CANCEL", "name": "Cancel Order" }
            ],
            "transitions": [
              {
                "from": "pending",
                "event": "INIT",
                "to": "pending",
                "effects": [
                  ["fetch", "Order"],
                  ["render-ui", "main", {
                    "type": "entity-table",
                    "entity": "Order",
                    "columns": ["customerName", "total"],
                    "itemActions": [
                      { "event": "CONFIRM", "label": "Confirm" },
                      { "event": "VIEW", "label": "View" }
                    ]
                  }]
                ]
              },
              {
                "from": "pending",
                "event": "VIEW",
                "to": "pending",
                "effects": [
                  ["navigate", "/orders/@payload.id"]
                ]
              },
              { "from": "pending", "event": "CONFIRM", "to": "confirmed" },
              { "from": "confirmed", "event": "SHIP", "to": "shipped" },
              { "from": "shipped", "event": "DELIVER", "to": "delivered" },
              { "from": "pending", "event": "CANCEL", "to": "cancelled" },
              { "from": "confirmed", "event": "CANCEL", "to": "cancelled" }
            ]
          }
        }
      ],
      "pages": [
        {
          "name": "OrderListPage",
          "path": "/orders",
          "traits": [
            { "ref": "OrderLifecycle", "linkedEntity": "Order" }
          ]
        }
      ]
    }
  ]
}
