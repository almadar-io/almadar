{
  "name": "patterns-test",
  "version": "1.0.0",
  "description": "Test: UI patterns (render_ui effects)",
  "orbitals": [
    {
      "name": "ProductManager",
      "entity": {
        "name": "Product",
        "persistence": "persistent",
        "collection": "products",
        "fields": [
          { "name": "id", "type": "string", "required": true },
          { "name": "name", "type": "string", "required": true },
          { "name": "description", "type": "string" },
          { "name": "price", "type": "number", "required": true },
          { "name": "stock", "type": "number", "default": 0 },
          { "name": "category", "type": "string" }
        ]
      },
      "traits": [
        {
          "name": "ProductCRUD",
          "linkedEntity": "Product",
          "category": "interaction",
          "stateMachine": {
            "states": [
              { "name": "listing", "isInitial": true },
              { "name": "viewing" },
              { "name": "editing" },
              { "name": "creating" }
            ],
            "events": [
              { "key": "MOUNT", "name": "Page Mount" },
              { "key": "VIEW", "name": "View Product", "payload": [
                { "name": "id", "type": "string", "required": true }
              ]},
              { "key": "EDIT", "name": "Edit Product" },
              { "key": "CREATE", "name": "Create Product" },
              { "key": "SAVE", "name": "Save" },
              { "key": "CANCEL", "name": "Cancel" },
              { "key": "BACK", "name": "Back to List" }
            ],
            "transitions": [
              {
                "from": "listing",
                "event": "MOUNT",
                "to": "listing",
                "effects": [
                  ["fetch", "products", { "collection": "products" }],
                  ["render-ui", "main", {
                    "type": "entity-table",
                    "props": {
                      "entity": "Product",
                      "columns": ["name", "price", "stock", "category"],
                      "actions": ["view", "edit", "delete"]
                    }
                  }]
                ]
              },
              {
                "from": "listing",
                "event": "VIEW",
                "to": "viewing",
                "effects": [
                  ["fetch", "product", { "collection": "products", "id": "@payload.id" }],
                  ["render-ui", "main", {
                    "type": "entity-detail",
                    "props": {
                      "entity": "Product",
                      "fields": ["name", "description", "price", "stock", "category"]
                    }
                  }]
                ]
              },
              {
                "from": "listing",
                "event": "CREATE",
                "to": "creating",
                "effects": [
                  ["render-ui", "main", {
                    "type": "form",
                    "props": {
                      "entity": "Product",
                      "fields": [
                        { "name": "name", "label": "Product Name", "required": true },
                        { "name": "description", "label": "Description", "type": "textarea" },
                        { "name": "price", "label": "Price", "type": "number", "required": true },
                        { "name": "stock", "label": "Stock", "type": "number" },
                        { "name": "category", "label": "Category" }
                      ]
                    }
                  }]
                ]
              },
              {
                "from": "viewing",
                "event": "EDIT",
                "to": "editing",
                "effects": [
                  ["render-ui", "main", {
                    "type": "form",
                    "props": {
                      "entity": "Product",
                      "mode": "edit"
                    }
                  }]
                ]
              },
              {
                "from": "viewing",
                "event": "BACK",
                "to": "listing",
                "effects": [
                  ["navigate", "/products"]
                ]
              },
              {
                "from": "editing",
                "event": "SAVE",
                "to": "viewing",
                "effects": [
                  ["persist", "product", { "collection": "products" }],
                  ["notify", "success", "Product saved successfully"]
                ]
              },
              {
                "from": "editing",
                "event": "CANCEL",
                "to": "viewing"
              },
              {
                "from": "creating",
                "event": "SAVE",
                "to": "listing",
                "effects": [
                  ["persist", "product", { "collection": "products" }],
                  ["notify", "success", "Product created successfully"],
                  ["navigate", "/products"]
                ]
              },
              {
                "from": "creating",
                "event": "CANCEL",
                "to": "listing",
                "effects": [
                  ["navigate", "/products"]
                ]
              }
            ]
          }
        }
      ],
      "pages": [
        {
          "name": "ProductListPage",
          "path": "/products",
          "traits": [
            { "ref": "ProductCRUD", "linkedEntity": "Product" }
          ]
        },
        {
          "name": "ProductDetailPage",
          "path": "/products/:id",
          "traits": [
            { "ref": "ProductCRUD", "linkedEntity": "Product" }
          ]
        }
      ]
    }
  ]
}
